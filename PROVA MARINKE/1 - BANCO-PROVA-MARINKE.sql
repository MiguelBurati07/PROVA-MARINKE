/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */;
/*!40101 SET NAMES utf8 */;
/*!50503 SET NAMES utf8mb4 */;
/*!40103 SET @OLD_TIME_ZONE=@@TIME_ZONE */;
/*!40103 SET TIME_ZONE='+00:00' */;
/*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */;
/*!40101 SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='NO_AUTO_VALUE_ON_ZERO' */;
/*!40111 SET @OLD_SQL_NOTES=@@SQL_NOTES, SQL_NOTES=0 */;

CREATE TABLE IF NOT EXISTS `cliente` (
  `idCLIENTE` int NOT NULL AUTO_INCREMENT,
  `NOME` varchar(45) DEFAULT NULL,
  PRIMARY KEY (`idCLIENTE`)
) ENGINE=InnoDB AUTO_INCREMENT=4 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

INSERT INTO `cliente` (`idCLIENTE`, `NOME`) VALUES
	(1, 'Ana Paula'),
	(2, 'Fernando Lima'),
	(3, 'Cláudia Oliveira');

CREATE TABLE IF NOT EXISTS `cliente_mesa` (
  `idCLIENTE_MESA` int NOT NULL AUTO_INCREMENT,
  `idCLIENTE` int NOT NULL,
  `idMESA` int NOT NULL,
  PRIMARY KEY (`idCLIENTE_MESA`),
  KEY `idCLIENTE` (`idCLIENTE`),
  KEY `idMESA` (`idMESA`),
  CONSTRAINT `cliente_mesa_ibfk_1` FOREIGN KEY (`idCLIENTE`) REFERENCES `cliente` (`idCLIENTE`),
  CONSTRAINT `cliente_mesa_ibfk_2` FOREIGN KEY (`idMESA`) REFERENCES `mesa` (`idMESA`)
) ENGINE=InnoDB AUTO_INCREMENT=4 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

INSERT INTO `cliente_mesa` (`idCLIENTE_MESA`, `idCLIENTE`, `idMESA`) VALUES
	(1, 1, 2),
	(2, 2, 3),
	(3, 3, 4);

CREATE TABLE IF NOT EXISTS `funcionario` (
  `idFUNCIONARIO` int NOT NULL AUTO_INCREMENT,
  `NOME` varchar(50) NOT NULL DEFAULT '0',
  PRIMARY KEY (`idFUNCIONARIO`)
) ENGINE=InnoDB AUTO_INCREMENT=4 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

INSERT INTO `funcionario` (`idFUNCIONARIO`, `NOME`) VALUES
	(1, 'João da Silva'),
	(2, 'Maria Souza'),
	(3, 'Carlos Pereira');

CREATE TABLE IF NOT EXISTS `funcionario_mesa` (
  `idFUNCIONARIO_MESA` int NOT NULL AUTO_INCREMENT,
  `idFUNCIONARIO` int NOT NULL,
  `idMESA` int NOT NULL,
  PRIMARY KEY (`idFUNCIONARIO_MESA`) USING BTREE,
  KEY `FUNCIONARIO-FK` (`idFUNCIONARIO`),
  KEY `MESA-FK` (`idMESA`),
  CONSTRAINT `FUNCIONARIO-FK` FOREIGN KEY (`idFUNCIONARIO`) REFERENCES `funcionario` (`idFUNCIONARIO`) ON DELETE CASCADE ON UPDATE CASCADE,
  CONSTRAINT `MESA-FK` FOREIGN KEY (`idMESA`) REFERENCES `mesa` (`idMESA`) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB AUTO_INCREMENT=4 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

INSERT INTO `funcionario_mesa` (`idFUNCIONARIO_MESA`, `idFUNCIONARIO`, `idMESA`) VALUES
	(1, 1, 2),
	(2, 2, 3),
	(3, 3, 4);

CREATE TABLE IF NOT EXISTS `mesa` (
  `idMESA` int NOT NULL AUTO_INCREMENT,
  `idPEDIDO` int DEFAULT NULL,
  `idSTATUS` int DEFAULT NULL,
  PRIMARY KEY (`idMESA`),
  KEY `idPEDIDO` (`idPEDIDO`),
  KEY `STATUS-FK` (`idSTATUS`),
  CONSTRAINT `mesa_ibfk_1` FOREIGN KEY (`idPEDIDO`) REFERENCES `pedido` (`idPEDIDO`),
  CONSTRAINT `STATUS-FK` FOREIGN KEY (`idSTATUS`) REFERENCES `status` (`idSTATUS`)
) ENGINE=InnoDB AUTO_INCREMENT=5 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

INSERT INTO `mesa` (`idMESA`, `idPEDIDO`, `idSTATUS`) VALUES
	(1, NULL, 1),
	(2, 1, 2),
	(3, 2, 1),
	(4, 3, 4);

CREATE TABLE IF NOT EXISTS `pagamento` (
  `idPAGAMENTO` int NOT NULL AUTO_INCREMENT,
  `TIPO` varchar(45) DEFAULT NULL,
  PRIMARY KEY (`idPAGAMENTO`)
) ENGINE=InnoDB AUTO_INCREMENT=4 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

INSERT INTO `pagamento` (`idPAGAMENTO`, `TIPO`) VALUES
	(1, 'Cartão de Crédito'),
	(2, 'Dinheiro'),
	(3, 'Pix');

CREATE TABLE IF NOT EXISTS `pedido` (
  `idPEDIDO` int NOT NULL AUTO_INCREMENT,
  `VALOR_TOTAL` double DEFAULT NULL,
  PRIMARY KEY (`idPEDIDO`)
) ENGINE=InnoDB AUTO_INCREMENT=4 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

INSERT INTO `pedido` (`idPEDIDO`, `VALOR_TOTAL`) VALUES
	(1, 50),
	(2, 75),
	(3, 30);

CREATE TABLE IF NOT EXISTS `pedido_pagamento` (
  `idPEDIDO_PAGAMENTO` int NOT NULL AUTO_INCREMENT,
  `idPEDIDO` int NOT NULL,
  `idPAGAMENTO` int NOT NULL,
  `VALOR` double NOT NULL,
  PRIMARY KEY (`idPEDIDO_PAGAMENTO`),
  KEY `idPEDIDO` (`idPEDIDO`),
  KEY `idPAGAMENTO` (`idPAGAMENTO`),
  CONSTRAINT `pedido_pagamento_ibfk_1` FOREIGN KEY (`idPEDIDO`) REFERENCES `pedido` (`idPEDIDO`),
  CONSTRAINT `pedido_pagamento_ibfk_2` FOREIGN KEY (`idPAGAMENTO`) REFERENCES `pagamento` (`idPAGAMENTO`)
) ENGINE=InnoDB AUTO_INCREMENT=4 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

INSERT INTO `pedido_pagamento` (`idPEDIDO_PAGAMENTO`, `idPEDIDO`, `idPAGAMENTO`, `VALOR`) VALUES
	(1, 1, 1, 50),
	(2, 2, 2, 75),
	(3, 3, 3, 30);

CREATE TABLE IF NOT EXISTS `pedido_produto` (
  `idPEDIDO_PRODUTO` int NOT NULL AUTO_INCREMENT,
  `idPEDIDO` int NOT NULL,
  `idPRODUTO` int NOT NULL,
  `QUANTIDADE` int NOT NULL,
  PRIMARY KEY (`idPEDIDO_PRODUTO`),
  KEY `idPEDIDO` (`idPEDIDO`),
  KEY `idPRODUTO` (`idPRODUTO`),
  CONSTRAINT `pedido_produto_ibfk_1` FOREIGN KEY (`idPEDIDO`) REFERENCES `pedido` (`idPEDIDO`),
  CONSTRAINT `pedido_produto_ibfk_2` FOREIGN KEY (`idPRODUTO`) REFERENCES `produto` (`idPRODUTO`)
) ENGINE=InnoDB AUTO_INCREMENT=5 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

INSERT INTO `pedido_produto` (`idPEDIDO_PRODUTO`, `idPEDIDO`, `idPRODUTO`, `QUANTIDADE`) VALUES
	(1, 1, 1, 2),
	(2, 1, 2, 1),
	(3, 2, 3, 5),
	(4, 3, 1, 1);

CREATE TABLE IF NOT EXISTS `produto` (
  `idPRODUTO` int NOT NULL AUTO_INCREMENT,
  `PRECO_UNITARIO` double NOT NULL,
  `QUANTIDADE_ESTOQUE` int NOT NULL,
  `ESTOQUE_MINIMO` int NOT NULL,
  `MARCA` varchar(45) DEFAULT NULL,
  PRIMARY KEY (`idPRODUTO`)
) ENGINE=InnoDB AUTO_INCREMENT=4 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

INSERT INTO `produto` (`idPRODUTO`, `PRECO_UNITARIO`, `QUANTIDADE_ESTOQUE`, `ESTOQUE_MINIMO`, `MARCA`) VALUES
	(1, 12.5, 100, 10, 'Coca-Cola'),
	(2, 25, 50, 5, 'Heineken'),
	(3, 7, 200, 20, 'Fandangos');

DELIMITER //
CREATE DEFINER=`root`@`localhost` PROCEDURE `RedefinirStatusMesaParaLivre`(
    IN p_idMesa INT
)
BEGIN
    DECLARE v_idStatusLivre INT;

    SELECT idSTATUS INTO v_idStatusLivre
    FROM status
    WHERE DESCRICAO = 'LIVRE';

    UPDATE mesa
    SET idSTATUS = v_idStatusLivre
    WHERE idMESA = p_idMesa;
END//
DELIMITER ;

CREATE TABLE IF NOT EXISTS `status` (
  `idSTATUS` int NOT NULL,
  `DESCRICAO` varchar(50) DEFAULT NULL,
  PRIMARY KEY (`idSTATUS`) USING BTREE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

INSERT INTO `status` (`idSTATUS`, `DESCRICAO`) VALUES
	(1, 'LIVRE'),
	(2, 'OCUPADA'),
	(3, 'SOBREMESA'),
	(4, 'OCUPADA-OCIOSA');

/*!40103 SET TIME_ZONE=IFNULL(@OLD_TIME_ZONE, 'system') */;
/*!40101 SET SQL_MODE=IFNULL(@OLD_SQL_MODE, '') */;
/*!40014 SET FOREIGN_KEY_CHECKS=IFNULL(@OLD_FOREIGN_KEY_CHECKS, 1) */;
/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */;
/*!40111 SET SQL_NOTES=IFNULL(@OLD_SQL_NOTES, 1) */;
